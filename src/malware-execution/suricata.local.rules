# ============================================================================
# CYBERFORTRESS REDOPS - Suricata Rules for Malware Execution Detection
# ============================================================================
# Detects EICAR download and malware dropper activities
# Copy to: /var/lib/suricata/rules/local.rules
# ============================================================================

# ----------------------------------------------------------------------------
# EICAR TEST FILE DOWNLOAD (T1105 - Ingress Tool Transfer)
# ----------------------------------------------------------------------------

# EICAR download from official source
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE EICAR Test File Download (secure.eicar.org)"; flow:to_server,established; http.host; content:"secure.eicar.org"; http.uri; content:"eicar"; classtype:trojan-activity; sid:9003001; rev:1;)

# EICAR download - any source
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE EICAR Test File Download"; flow:to_server,established; http.uri; content:"eicar.com"; classtype:trojan-activity; sid:9003002; rev:1;)

# EICAR signature in HTTP response
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE EICAR Test File in HTTP Response"; flow:to_client,established; file_data; content:"X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"; classtype:trojan-activity; sid:9003003; rev:1;)

# ----------------------------------------------------------------------------
# POWERSHELL DOWNLOAD CRADLE (T1059.001)
# ----------------------------------------------------------------------------

# Invoke-WebRequest download
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE PowerShell Invoke-WebRequest Download"; flow:to_server,established; http.user_agent; content:"PowerShell"; classtype:trojan-activity; sid:9003010; rev:1;)

# Suspicious .txt download (often used for malware)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE Suspicious TXT File Download"; flow:to_server,established; http.uri; content:".txt"; endswith; http.user_agent; content:"PowerShell"; classtype:trojan-activity; sid:9003011; rev:1;)

# ----------------------------------------------------------------------------
# DROPPER ACTIVITY (T1204.002 - User Execution: Malicious File)
# ----------------------------------------------------------------------------

# Executable downloading files
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"DROPPER Executable Downloading Payload"; flow:to_server,established; http.method; content:"GET"; http.uri; pcre:"/\.(exe|dll|ps1|bat|cmd|vbs|js)$/i"; classtype:trojan-activity; sid:9003020; rev:1;)
